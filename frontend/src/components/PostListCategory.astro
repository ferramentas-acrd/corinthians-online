---
import { getImageUrl, formatDate, getPostDate } from '../lib/strapi';

export interface Props {
  categoryName: string;           // ex: "Futebol"
  categorySlug: string;           // ex: "futebol"
  posts: any[];                   // posts dessa categoria
  limit?: number;                 // opcional: quantos posts mostrar (default 4)
  routePrefix?: string;           // prefixo da rota de posts (default: env PUBLIC_ROUTE_PREFIX || 'apostas')
  categoryPrefix?: string;        // prefixo da rota de categoria (default: 'categoria')
}

const {
  categoryName,
  categorySlug,
  posts = [],
  limit = 4,
  routePrefix = import.meta.env.PUBLIC_ROUTE_PREFIX || 'apostas',
  categoryPrefix = 'categoria',
} = Astro.props;

const items = posts.slice(0, limit);
const totalPosts = posts.length;
---

<section class="catblock">
  <div class="catblock__header">
    <h2 class="catblock__title">{categoryName}</h2>
    <a href={`/${routePrefix}/${categoryPrefix}/${categorySlug}`} class="catblock__more" aria-label={`Ver mais em ${categoryName}`}>
      <span class="catblock__more-text">Ver mais ({totalPosts})</span>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
      </svg>
    </a>
  </div>

  <div class="catblock__grid">
    {items.map((post) => {
      const img = getImageUrl(post.coverImage, 'medium');
      const date = getPostDate(post);
      return (
        <article class="catblock-card">
          <a href={`/${routePrefix}/${post.slug}`} class="catblock-card__link">
            <div class="catblock-card__media">
              {post.coverImage && (
                <img
                  src={img}
                  alt={post.coverImage?.alternativeText || post.title}
                  loading="lazy"
                />
              )}
              {post.category && (
                <span class="catblock-card__badge">{post.category.name}</span>
              )}
            </div>
            <div class="catblock-card__body">
              <h3 class="catblock-card__title">{post.title}</h3>
              <div class="catblock-card__meta">
                {post.authors?.[0] && <span class="catblock-card__author">{post.authors[0].name}</span>}
                <time class="catblock-card__date" datetime={date}>{formatDate(date)}</time>
              </div>
            </div>
          </a>
        </article>
      );
    })}
  </div>
</section>

<style>
  /* ===== CategoryBlock (classes exclusivas: catblock-*) ===== */

  .catblock { margin: 2rem 0; }

  .catblock__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .75rem;
    margin-bottom: 1rem;
  }

  .catblock__title {
    font-family: "Merriweather", Georgia, serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: #FFD700; /* Amarelo dourado */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }

  .catblock__more {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
    text-decoration: none;
    font-weight: 700;
    font-family: "Roboto", sans-serif;
    font-size: .95rem;
    padding: .5rem .9rem;
    border-radius: 6px;
    color: #fff;
    background: var(--color-primary, #d80027);
    transition: transform .2s ease, background .2s ease, box-shadow .2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
    white-space: nowrap;
  }
  
  .catblock__more:hover {
    background: var(--color-primary-dark, #b30606);
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(0,0,0,.12);
  }

  .catblock__grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 1.25rem;
  }

  .catblock-card {
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
    transition: transform .25s ease, box-shadow .25s ease;
    height: 100%;
  }
  .catblock-card:hover { transform: translateY(-3px); box-shadow: 0 10px 24px rgba(0,0,0,.12); }

  .catblock-card__link { display: flex; flex-direction: column; height: 100%; color: inherit; text-decoration: none; }

  .catblock-card__media {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 */
    background: var(--color-bg-secondary, #f5f5f5);
    overflow: hidden;
  }
  .catblock-card__media img {
    position: absolute; inset: 0;
    width: 100%; height: 100%;

    display: block;
  }
  .catblock-card:hover .catblock-card__media img { transform: scale(1.05); }

  .catblock-card__badge {
    position: absolute; top: 12px; left: 12px;
    padding: 4px 10px; border-radius: 4px;
    background: var(--color-primary, #d80027); color: #fff;
    font-size: .72rem; font-weight: 700; text-transform: uppercase;
    font-family: "Roboto", sans-serif;
  }

  .catblock-card__body { padding: 1rem; display: flex; flex-direction: column; gap: .5rem; }
  .catblock-card__title {
    font-size: 1.02rem; font-weight: 700; line-height: 1.3;
    color: var(--color-text, #222);
    font-family: "Merriweather", Georgia, serif;
    display: -webkit-box; 
    -webkit-line-clamp: 2; 
    line-clamp: 2;
    -webkit-box-orient: vertical; 
    overflow: hidden;
  }

  .catblock-card__meta {
    margin-top: auto;
    display: flex; align-items: center; gap: .5rem;
    font-size: .82rem; color: var(--color-text-light, #666);
    font-family: "Roboto", sans-serif;
  }

  .catblock-card__author { font-weight: 600; }
  .catblock-card__author::after { content: 'â€¢'; margin: 0 .5rem; opacity: .6; }
  .catblock-card__date { color: var(--color-text-light, #666); }

  @media (max-width: 1024px) {
    .catblock__grid { 
      grid-template-columns: repeat(2, minmax(0, 1fr)); 
    }
  }
  
  @media (max-width: 768px) {
    .catblock__header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .catblock__title {
      font-size: 1.3rem;
    }
    
    .catblock__more {
      align-self: stretch;
      justify-content: center;
      font-size: .9rem;
    }
  }
  
  @media (max-width: 640px) {
    .catblock__grid { 
      grid-template-columns: 1fr; 
    }
    
    .catblock__more-text {
      font-size: .85rem;
    }
  }
  
  @media (max-width: 480px) {
    .catblock {
      margin: 1.5rem 0;
    }
    
    .catblock__title {
      font-size: 1.2rem;
    }
    
    .catblock__more {
      padding: .6rem 1rem;
    }
  }
</style>
