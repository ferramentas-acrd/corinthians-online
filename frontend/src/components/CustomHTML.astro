---
import { getCustomHTMLByTitle, decodeCustomHTML, clearCustomHTMLCache } from '../lib/strapi';

export interface Props {
  title: string;
  forceRefresh?: boolean;
}

const { title, forceRefresh = false } = Astro.props;

if (forceRefresh) {
  clearCustomHTMLCache();
}

const customHTML = await getCustomHTMLByTitle(title);

function processHTML(htmlString: string): string {
  if (!htmlString) return '';
  let processedHTML = decodeCustomHTML(htmlString);
  processedHTML = processedHTML.replace(/<!--[\s\S]*?-->/g, '');
  return processedHTML.trim();
}

const headerHTML = customHTML?.header ? processHTML(customHTML.header) : '';
const bodyHTML = customHTML?.body ? processHTML(customHTML.body) : '';
const footerHTML = customHTML?.footer ? processHTML(customHTML.footer) : '';

export { headerHTML, bodyHTML, footerHTML };
---

{headerHTML && (
  <Fragment set:html={headerHTML} slot="head" />
)}

{bodyHTML && (
  <div class="custom-html-body" data-html-title={title}>
    <Fragment set:html={bodyHTML} />
  </div>
)}

{footerHTML && (
  <div class="custom-html-footer" data-html-title={title}>
    <Fragment set:html={footerHTML} />
  </div>
)}