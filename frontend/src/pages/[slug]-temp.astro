---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getNoticiaBySlug, type NoticiaData } from '../lib/database';
import { formatDate } from '../lib/strapi';

const { slug } = Astro.params;

// Buscar o post pelo slug
const post = await getNoticiaBySlug(slug);

if (!post) {
  return Astro.redirect('/404');
}

// Se o slug encontrado é diferente do slug solicitado, redirecionar
if (post.slug !== slug) {
  return Astro.redirect(`/${post.slug}`, 301);
}

const publishDate = post.published_at || post.created_at;
---

<Layout title={post.title}>
  <Header />
  
  <main class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 py-8">
      <!-- Breadcrumb -->
      <nav class="breadcrumb mb-6" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-gray-600">
          <li><a href="/" class="hover:text-blue-600">Início</a></li>
          <li>›</li>
          <li><a href="/noticias" class="hover:text-blue-600">Notícias</a></li>
          <li>›</li>
          <li class="text-gray-900 truncate">{post.title.substring(0, 50)}...</li>
        </ol>
      </nav>

      <!-- Article Container -->
      <div class="max-w-4xl mx-auto">
        <article class="bg-white rounded-lg shadow-lg overflow-hidden">
          <!-- Article Header -->
          <header class="p-6 pb-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight">
              {post.title}
            </h1>
            
            {post.excerpt && (
              <p class="text-lg text-gray-600 mb-6 leading-relaxed">
                {post.excerpt}
              </p>
            )}

            <div class="flex items-center text-sm text-gray-500 mb-6">
              <time datetime={publishDate}>
                {formatDate(publishDate)}
              </time>
            </div>
          </header>

          <!-- Article Content -->
          <div class="p-6">
            <div class="prose prose-lg max-w-none">
              <p class="text-gray-700 leading-relaxed">
                Este é um artigo do sistema CMS integrado. O conteúdo completo será carregado em breve.
              </p>
              
              <p class="text-gray-700 leading-relaxed mt-4">
                <strong>Título:</strong> {post.title}
              </p>
              
              <p class="text-gray-700 leading-relaxed">
                <strong>Slug:</strong> {post.slug}
              </p>
              
              <p class="text-gray-700 leading-relaxed">
                <strong>Data de Publicação:</strong> {formatDate(publishDate)}
              </p>
              
              {post.excerpt && (
                <p class="text-gray-700 leading-relaxed">
                  <strong>Resumo:</strong> {post.excerpt}
                </p>
              )}
            </div>
          </div>

          <!-- Back to News -->
          <div class="p-6 border-t bg-gray-50">
            <a href="/noticias" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
              ← Voltar para todas as notícias
            </a>
          </div>
        </article>
      </div>
    </div>
  </main>
  
  <Footer />
</Layout>